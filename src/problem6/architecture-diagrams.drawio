<mxfile host="app.diagrams.net" modified="2025-09-13T00:00:00.000Z" agent="5.0" etag="drawio-diagram" version="21.6.5" type="device">
  <diagram name="System Architecture" id="system-architecture">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Client Applications -->
        <mxCell id="client-mobile" value="Mobile App&#xa;(iOS/Android)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="client-web" value="Web App&#xa;(React/Vue)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="240" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="client-game" value="Game Client&#xa;(Unity/Unreal)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="400" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Load Balancer -->
        <mxCell id="load-balancer" value="Load Balancer&#xa;(Nginx/AWS ALB)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="240" y="200" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- API Gateway -->
        <mxCell id="api-gateway" value="API Gateway&#xa;(Rate Limiting, Auth)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="240" y="320" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- API Servers -->
        <mxCell id="api-server-1" value="API Server 1&#xa;(Express.js)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="120" y="440" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="api-server-2" value="API Server 2&#xa;(Express.js)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="250" y="440" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="api-server-3" value="API Server 3&#xa;(Express.js)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="380" y="440" width="100" height="60" as="geometry" />
        </mxCell>
        
        <!-- WebSocket Manager -->
        <mxCell id="websocket-manager" value="WebSocket Manager&#xa;(Real-time Updates)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="520" y="440" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Redis Cluster -->
        <mxCell id="redis-cache" value="Redis Cache&#xa;(Session, Leaderboard)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="120" y="560" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="redis-pubsub" value="Redis Pub/Sub&#xa;(Real-time Events)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="280" y="560" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Database -->
        <mxCell id="database-primary" value="PostgreSQL Primary&#xa;(Write Operations)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="440" y="560" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="database-replica" value="PostgreSQL Replica&#xa;(Read Operations)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="600" y="560" width="140" height="60" as="geometry" />
        </mxCell>
        
        <!-- Monitoring -->
        <mxCell id="monitoring" value="Monitoring&#xa;(Prometheus/Grafana)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6ffe6;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="760" y="320" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Security -->
        <mxCell id="security" value="Security Scanner&#xa;(Rate Limiting, DDoS)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="760" y="440" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Connections -->
        <mxCell id="edge1" edge="1" parent="1" source="client-mobile" target="load-balancer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge2" edge="1" parent="1" source="client-web" target="load-balancer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge3" edge="1" parent="1" source="client-game" target="load-balancer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge4" edge="1" parent="1" source="load-balancer" target="api-gateway">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge5" edge="1" parent="1" source="api-gateway" target="api-server-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge6" edge="1" parent="1" source="api-gateway" target="api-server-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge7" edge="1" parent="1" source="api-gateway" target="api-server-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge8" edge="1" parent="1" source="api-server-1" target="redis-cache">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge9" edge="1" parent="1" source="api-server-2" target="redis-pubsub">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge10" edge="1" parent="1" source="api-server-3" target="database-primary">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge11" edge="1" parent="1" source="websocket-manager" target="redis-pubsub">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge12" edge="1" parent="1" source="database-primary" target="database-replica">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Labels -->
        <mxCell id="label-clients" value="Client Layer" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="30" y="40" width="100" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="label-gateway" value="Gateway Layer" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="30" y="260" width="100" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="label-services" value="Service Layer" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="30" y="400" width="100" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="label-data" value="Data Layer" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="30" y="520" width="100" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  
  <diagram name="Score Update Flow" id="score-update-flow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Game Client -->
        <mxCell id="game-client" value="Game Client" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Steps -->
        <mxCell id="step1" value="1. Player Action&#xa;(level complete, item collect)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="280" y="80" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="step2" value="2. Generate HMAC&#xa;Signature" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="80" y="200" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="step3" value="3. POST /api/v1/scores/update&#xa;{action + signature}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="280" y="200" width="180" height="60" as="geometry" />
        </mxCell>
        
        <!-- API Server -->
        <mxCell id="api-server" value="API Server" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="540" y="200" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Validation Steps -->
        <mxCell id="step4" value="4. Validate JWT Token" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="80" y="320" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="step5" value="5. Verify HMAC&#xa;Signature" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="280" y="320" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="step6" value="6. Check Duplicate&#xa;Action (Redis)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="460" y="320" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="step7" value="7. Validate Score&#xa;Rules" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="640" y="320" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Database Transaction -->
        <mxCell id="step8" value="8. Begin DB Transaction" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="80" y="440" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="step9" value="9. Insert Action Record" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="280" y="440" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="step10" value="10. Update User Score" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="480" y="440" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="step11" value="11. Calculate New Rank" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="680" y="440" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="step12" value="12. Commit Transaction" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="80" y="560" width="140" height="60" as="geometry" />
        </mxCell>
        
        <!-- Cache and Real-time Updates -->
        <mxCell id="step13" value="13. Update Cache&#xa;(Redis)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="280" y="560" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="step14" value="14. Publish Event&#xa;(Pub/Sub)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="460" y="560" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="step15" value="15. WebSocket Broadcast&#xa;to All Clients" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="640" y="560" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="step16" value="16. Return Response&#xa;{newScore, newRank}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="280" y="680" width="160" height="60" as="geometry" />
        </mxCell>
        
        <!-- Flow arrows -->
        <mxCell id="flow1" edge="1" parent="1" source="game-client" target="step1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow2" edge="1" parent="1" source="step1" target="step2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow3" edge="1" parent="1" source="step2" target="step3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow4" edge="1" parent="1" source="step3" target="api-server">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow5" edge="1" parent="1" source="api-server" target="step4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow6" edge="1" parent="1" source="step4" target="step5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow7" edge="1" parent="1" source="step5" target="step6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow8" edge="1" parent="1" source="step6" target="step7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow9" edge="1" parent="1" source="step7" target="step8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow10" edge="1" parent="1" source="step8" target="step9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow11" edge="1" parent="1" source="step9" target="step10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow12" edge="1" parent="1" source="step10" target="step11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow13" edge="1" parent="1" source="step11" target="step12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow14" edge="1" parent="1" source="step12" target="step13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow15" edge="1" parent="1" source="step13" target="step14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow16" edge="1" parent="1" source="step14" target="step15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow17" edge="1" parent="1" source="step15" target="step16">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  
  <diagram name="Security Flow" id="security-flow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Client -->
        <mxCell id="client" value="Client Application" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Authentication Flow -->
        <mxCell id="auth-request" value="1. Login Request&#xa;POST /auth/login" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="280" y="80" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="credential-check" value="2. Validate Credentials&#xa;(bcrypt hash)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="480" y="80" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="jwt-generate" value="3. Generate JWT Token&#xa;(24h expiry)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="680" y="80" width="140" height="60" as="geometry" />
        </mxCell>
        
        <!-- API Request Flow -->
        <mxCell id="api-request" value="4. API Request&#xa;Authorization: Bearer {token}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="80" y="200" width="160" height="60" as="geometry" />
        </mxCell>
        
        <!-- Security Layers -->
        <mxCell id="rate-limiter" value="5. Rate Limiter&#xa;(100 req/min per IP)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="300" y="200" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="jwt-verify" value="6. JWT Verification&#xa;(signature + expiry)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="500" y="200" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="hmac-verify" value="7. HMAC Verification&#xa;(action signature)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="700" y="200" width="140" height="60" as="geometry" />
        </mxCell>
        
        <!-- Anti-Cheat Measures -->
        <mxCell id="timestamp-check" value="8. Timestamp Check&#xa;(±30 seconds)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="80" y="320" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="duplicate-check" value="9. Duplicate Prevention&#xa;(action ID cache)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="280" y="320" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="score-validation" value="10. Score Validation&#xa;(business rules)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="480" y="320" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="anomaly-detection" value="11. Anomaly Detection&#xa;(ML-based)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="680" y="320" width="140" height="60" as="geometry" />
        </mxCell>
        
        <!-- Security Response -->
        <mxCell id="security-decision" value="Security Decision Engine" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="350" y="440" width="140" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="allow-request" value="Allow Request&#xa;(Process normally)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="180" y="580" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="block-request" value="Block Request&#xa;(403 Forbidden)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="360" y="580" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="ban-user" value="Ban User Account&#xa;(Severe violations)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="540" y="580" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Security Monitoring -->
        <mxCell id="security-log" value="Security Event Log&#xa;(Audit trail)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6ffe6;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="720" y="580" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Flow connections -->
        <mxCell id="sflow1" edge="1" parent="1" source="client" target="auth-request">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow2" edge="1" parent="1" source="auth-request" target="credential-check">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow3" edge="1" parent="1" source="credential-check" target="jwt-generate">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow4" edge="1" parent="1" source="client" target="api-request">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow5" edge="1" parent="1" source="api-request" target="rate-limiter">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow6" edge="1" parent="1" source="rate-limiter" target="jwt-verify">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow7" edge="1" parent="1" source="jwt-verify" target="hmac-verify">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow8" edge="1" parent="1" source="hmac-verify" target="timestamp-check">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow9" edge="1" parent="1" source="timestamp-check" target="duplicate-check">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow10" edge="1" parent="1" source="duplicate-check" target="score-validation">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow11" edge="1" parent="1" source="score-validation" target="anomaly-detection">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow12" edge="1" parent="1" source="anomaly-detection" target="security-decision">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow13" edge="1" parent="1" source="security-decision" target="allow-request">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow14" edge="1" parent="1" source="security-decision" target="block-request">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow15" edge="1" parent="1" source="security-decision" target="ban-user">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sflow16" edge="1" parent="1" source="security-decision" target="security-log">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Labels -->
        <mxCell id="slabel1" value="PASS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#82b366;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="270" y="510" width="40" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="slabel2" value="SUSPICIOUS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#d79b00;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="400" y="510" width="80" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="slabel3" value="MALICIOUS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#b85450;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="560" y="510" width="80" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  
  <diagram name="WebSocket Communication" id="websocket-flow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Multiple Clients -->
        <mxCell id="client1" value="Client 1&#xa;(Mobile)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="client2" value="Client 2&#xa;(Web)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="200" y="80" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="client3" value="Client 3&#xa;(Game)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="320" y="80" width="100" height="60" as="geometry" />
        </mxCell>
        
        <!-- WebSocket Manager -->
        <mxCell id="ws-manager" value="WebSocket Manager&#xa;(Connection Hub)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="180" y="200" width="140" height="60" as="geometry" />
        </mxCell>
        
        <!-- Connection Process -->
        <mxCell id="ws-connect" value="1. WebSocket Handshake&#xa;ws://api.example.com/ws" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="480" y="80" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="ws-auth" value="2. Authentication&#xa;{type: 'auth', token: 'JWT'}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="480" y="160" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="ws-subscribe" value="3. Subscribe to Channels&#xa;{type: 'subscribe', channel: 'leaderboard'}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="480" y="240" width="180" height="60" as="geometry" />
        </mxCell>
        
        <!-- Redis Pub/Sub Integration -->
        <mxCell id="redis-pubsub" value="Redis Pub/Sub&#xa;(Event Distribution)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="180" y="340" width="140" height="60" as="geometry" />
        </mxCell>
        
        <!-- API Server Integration -->
        <mxCell id="api-server-ws" value="API Server&#xa;(Score Updates)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="400" y="340" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Event Types -->
        <mxCell id="event-score" value="Score Update Event&#xa;{type: 'score_update', data: {...}}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="80" y="460" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="event-leaderboard" value="Leaderboard Event&#xa;{type: 'leaderboard_update', data: {...}}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="280" y="460" width="180" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="event-rank" value="Rank Change Event&#xa;{type: 'rank_change', data: {...}}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="500" y="460" width="160" height="60" as="geometry" />
        </mxCell>
        
        <!-- Message Flow -->
        <mxCell id="broadcast-flow" value="Real-time Broadcast Flow" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="200" y="580" width="200" height="40" as="geometry" />
        </mxCell>
        
        <!-- Heartbeat -->
        <mxCell id="heartbeat" value="Heartbeat System&#xa;ping/pong (30s)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6ffe6;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="720" y="200" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Connection Management -->
        <mxCell id="connection-pool" value="Connection Pool&#xa;(Active Clients)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="720" y="340" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Error Handling -->
        <mxCell id="error-handling" value="Error Handling&#xa;(Reconnection Logic)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="720" y="460" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Flow connections -->
        <mxCell id="wflow1" edge="1" parent="1" source="client1" target="ws-manager">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wflow2" edge="1" parent="1" source="client2" target="ws-manager">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wflow3" edge="1" parent="1" source="client3" target="ws-manager">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wflow4" edge="1" parent="1" source="ws-manager" target="redis-pubsub">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wflow5" edge="1" parent="1" source="api-server-ws" target="redis-pubsub">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wflow6" edge="1" parent="1" source="redis-pubsub" target="event-score">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wflow7" edge="1" parent="1" source="redis-pubsub" target="event-leaderboard">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wflow8" edge="1" parent="1" source="redis-pubsub" target="event-rank">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Labels for message types -->
        <mxCell id="wlabel1" value="Real-time Updates" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="50" y="420" width="100" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="wlabel2" value="Connection Management" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="720" y="160" width="120" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  
  <diagram name="Database Schema" id="database-schema">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Users Table -->
        <mxCell id="users-table" value="users" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="200" height="220" as="geometry" />
        </mxCell>
        <mxCell id="users-fields" value="id (UUID, PK)&#xa;username (VARCHAR(50), UNIQUE)&#xa;email (VARCHAR(255), UNIQUE)&#xa;password_hash (VARCHAR(255))&#xa;current_score (BIGINT, DEFAULT 0)&#xa;current_rank (INTEGER)&#xa;total_games_played (INTEGER)&#xa;is_active (BOOLEAN, DEFAULT true)&#xa;is_banned (BOOLEAN, DEFAULT false)&#xa;last_activity (TIMESTAMP)&#xa;created_at (TIMESTAMP)&#xa;updated_at (TIMESTAMP)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="users-table">
          <mxGeometry y="26" width="200" height="194" as="geometry" />
        </mxCell>
        
        <!-- Score Actions Table -->
        <mxCell id="score-actions-table" value="score_actions" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="360" y="80" width="220" height="200" as="geometry" />
        </mxCell>
        <mxCell id="score-actions-fields" value="id (UUID, PK)&#xa;user_id (UUID, FK → users.id)&#xa;action_id (VARCHAR(255), UNIQUE)&#xa;action_type (VARCHAR(50))&#xa;score_increase (INTEGER)&#xa;action_data (JSONB)&#xa;signature (VARCHAR(512))&#xa;client_timestamp (TIMESTAMP)&#xa;server_timestamp (TIMESTAMP)&#xa;is_verified (BOOLEAN)&#xa;created_at (TIMESTAMP)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="score-actions-table">
          <mxGeometry y="26" width="220" height="174" as="geometry" />
        </mxCell>
        
        <!-- Game Sessions Table -->
        <mxCell id="game-sessions-table" value="game_sessions" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="660" y="80" width="200" height="180" as="geometry" />
        </mxCell>
        <mxCell id="game-sessions-fields" value="id (UUID, PK)&#xa;user_id (UUID, FK → users.id)&#xa;session_token (VARCHAR(255))&#xa;game_type (VARCHAR(50))&#xa;start_time (TIMESTAMP)&#xa;end_time (TIMESTAMP)&#xa;total_score (INTEGER)&#xa;is_active (BOOLEAN)&#xa;client_info (JSONB)&#xa;created_at (TIMESTAMP)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="game-sessions-fields">
          <mxGeometry y="26" width="200" height="154" as="geometry" />
        </mxCell>
        
        <!-- Leaderboards Table -->
        <mxCell id="leaderboards-table" value="leaderboards" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="80" y="340" width="200" height="160" as="geometry" />
        </mxCell>
        <mxCell id="leaderboards-fields" value="id (UUID, PK)&#xa;user_id (UUID, FK → users.id)&#xa;leaderboard_type (VARCHAR(50))&#xa;score (BIGINT)&#xa;rank_position (INTEGER)&#xa;time_period (VARCHAR(20))&#xa;snapshot_date (DATE)&#xa;created_at (TIMESTAMP)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="leaderboards-table">
          <mxGeometry y="26" width="200" height="134" as="geometry" />
        </mxCell>
        
        <!-- Audit Log Table -->
        <mxCell id="audit-log-table" value="audit_log" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="360" y="340" width="200" height="160" as="geometry" />
        </mxCell>
        <mxCell id="audit-log-fields" value="id (UUID, PK)&#xa;user_id (UUID, FK → users.id)&#xa;event_type (VARCHAR(50))&#xa;event_data (JSONB)&#xa;ip_address (INET)&#xa;user_agent (TEXT)&#xa;severity_level (VARCHAR(20))&#xa;created_at (TIMESTAMP)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="audit-log-table">
          <mxGeometry y="26" width="200" height="134" as="geometry" />
        </mxCell>
        
        <!-- Rate Limits Table -->
        <mxCell id="rate-limits-table" value="rate_limits" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="640" y="340" width="200" height="140" as="geometry" />
        </mxCell>
        <mxCell id="rate-limits-fields" value="id (UUID, PK)&#xa;identifier (VARCHAR(255))&#xa;identifier_type (VARCHAR(20))&#xa;request_count (INTEGER)&#xa;window_start (TIMESTAMP)&#xa;window_duration (INTEGER)&#xa;created_at (TIMESTAMP)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="rate-limits-table">
          <mxGeometry y="26" width="200" height="114" as="geometry" />
        </mxCell>
        
        <!-- Relationships -->
        <mxCell id="rel1" edge="1" parent="1" source="users-fields" target="score-actions-fields">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel2" edge="1" parent="1" source="users-fields" target="game-sessions-fields">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel3" edge="1" parent="1" source="users-fields" target="leaderboards-fields">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel4" edge="1" parent="1" source="users-fields" target="audit-log-fields">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Indexes and Constraints -->
        <mxCell id="indexes-title" value="Key Indexes & Constraints" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="80" y="540" width="200" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="indexes-list" value="• users.username (UNIQUE)&#xa;• users.email (UNIQUE)&#xa;• users.current_score (DESC)&#xa;• score_actions.action_id (UNIQUE)&#xa;• score_actions.user_id + created_at&#xa;• game_sessions.user_id + is_active&#xa;• leaderboards.leaderboard_type + rank_position&#xa;• audit_log.user_id + created_at&#xa;• rate_limits.identifier + window_start" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="1">
          <mxGeometry x="80" y="570" width="300" height="140" as="geometry" />
        </mxCell>
        
        <!-- Partitioning Strategy -->
        <mxCell id="partitioning-title" value="Partitioning Strategy" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="440" y="540" width="200" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="partitioning-list" value="• score_actions: Partition by created_at (monthly)&#xa;• audit_log: Partition by created_at (weekly)&#xa;• leaderboards: Partition by time_period&#xa;• Archive old partitions to cold storage&#xa;• Use time-based retention policies" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="1">
          <mxGeometry x="440" y="570" width="300" height="80" as="geometry" />
        </mxCell>
        
        <!-- Relationship labels -->
        <mxCell id="rel-label1" value="1:N" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="300" y="150" width="30" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="rel-label2" value="1:N" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="580" y="150" width="30" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="rel-label3" value="1:N" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="200" y="320" width="30" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="rel-label4" value="1:N" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="300" y="320" width="30" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>